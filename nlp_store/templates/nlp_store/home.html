{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
    <h1>üîç ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

    <form method="get">
        <input type="text" name="search" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." required>
        <input type="submit" value="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤">
    </form>

    {% if not query %}
        <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° 3 ‡∏ä‡∏¥‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ:</p>

        <div id="random-product" class="product-list"></div>

        <script>
            const randomProducts = [
                {% for name, desc, img_path in random_products %}
                    {
                        name: "{{ name|escapejs }}",
                        desc: "{{ desc|escapejs }}",
                        img: "{% static img_path %}"
                    },
                {% endfor %}
            ];

            function getRandomSample(array, count) {
                const shuffled = array.slice().sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            function showRandomProducts() {
                const selected = getRandomSample(randomProducts, 3);
                const container = document.getElementById("random-product");

                container.innerHTML = selected.map(product => `
                    <div class="product-card">
                        <h3>${product.name}</h3>
                        <p>${product.desc}</p>
                        <img src="${product.img}" class="product-img" alt="${product.name}">
                    </div>
                `).join('');
            }

            showRandomProducts();  // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            setInterval(showRandomProducts, 3000);  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥
        </script>
    {% endif %}

    {% if query %}
        <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "{{ query }}"</h2>

        {% if suggestion_text %}
            <p style="color: red;">{{ suggestion_text }}</p>
        {% endif %}

        <div class="product-list">
            {% for name, desc, img_path in similar_products %}
                <div class="product-card">
                    <h3>{{ name }}</h3>
                    <p>{{ desc }}</p>
                    <img src="{% static img_path %}" class="product-img" alt="{{ name }}">
                </div>
            {% endfor %}
        </div>
    {% endif %}
</body>
</html>
